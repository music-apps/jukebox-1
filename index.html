<!DOCTYPE html>
<html ng-app="application">
<head>
    <title>Jukebox</title>
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'/>
    <link href="js/vendor/angular-slider.css" media="screen" rel="stylesheet"/>
    <link href="css/layout.css" media="screen" rel="stylesheet"/>
    <link href="css/theme.css" media="screen" rel="stylesheet"/>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body ng-cloak ng-controller="Main">
    <header>
        <h1>Jukebox</h1>
        <p><strong>v{{ version }}</strong> - <span class="muted">{{ versionName }}</span></p>
        <form ng-submit="login()" ng-hide="auth || initializing || needUpdate">
            <fieldset>
                <input type="text" name="username" id="username" ng-model="username" size="10" placeholder="username" />
                <input type="text" name="passcode" id="passcode" ng-model="passcode" size="5" placeholder="passcode" />
            </fieldset>
            <button type="submit"><span>Log In</span></button>
        </form>
        <p ng-show="auth">{{ username }}<span><strong>{{ getKudos() || 0 | number }} </strong>kudos</span></p>
    </header>
    <p ng-show="needUpdate" class="error"><strong>Your version is out of date,</strong> or vegeta locked the app. <strong>Shift+F5</strong> to get the latest version.</p>
    <section ng-hide="initializing || needUpdate">
        <div class="canvas-header">
            <span ng-repeat="mode in canvasModes" ng-click="changeCanvasMode(mode)" ng-class="{selected: canvasData.canvasMode == mode}" ng-show="auth">{{ mode }}</span>
        </div>
        <div id="player"></div>
        <div class="canvases" ng-show="auth"><div>
            <canvas id="mainUnderCanvas" width="640" height="370"></canvas>
            <canvas id="mainCanvas" width="640" height="370"></canvas>
            <canvas id="highUnderCanvas" width="640" height="370"></canvas>
            <canvas id="highCanvas" width="640" height="370"></canvas>
        </div></div>
        <div class="isketch clearfix" ng-show="canvasData.canvasMode == 'isketch'">
            <h3 ng-show="canvasData.isketch.challenge && !canvasData.isketch.winner">Your word is: <strong>{{ canvasData.isketch.challenge.word }}</strong></h3>
            <h3 ng-show="canvasData.isketch.winner"><strong><span ng-style="{color: '#'+getUserColor(canvasData.isketch.winner.user)}">{{canvasData.isketch.winner.user}}</span> won! </strong>The answer was: <strong>{{ canvasData.isketch.winner.word }}</strong></h3>
            <button ng-click="canvasData.isketch.startGame()" ng-disabled="canvasData.isketch.startingGame" ng-hide="canvasData.isketch.host && canvasData.isketch.status != 'loading'">Play iSketch!</button>
            <div class="message" ng-show="canvasData.isketch.message" ng-click="canvasData.isketch.message = null">
                <p ng-class="canvasData.isketch.message.type" ng-bind-html="canvasData.isketch.message.text"></p>
                <p ng-show="canvasData.isketch.message.kudos">You {{message.kudos > 0 ? 'gained' : 'lost'}} <strong>{{ message.kudos }}</strong> kudos!</p>
            </div>
            <div class="guesses" ng-show="canvasData.isketch.status == 'playing'">
                <ul><li ng-repeat="guess in canvasData.isketch.guesses | reverse" class="animate-repeat reverse">
                    <strong ng-style="{color: '#'+getUserColor(guess.user)}">{{ guess.user }}</strong><span>:  {{guess.text}}</span>
                </li></ul>
            </div>
            <form ng-submit="canvasData.isketch.submitGuess()" ng-show="canvasData.isketch.status == 'playing' && !canvasData.isketch.challenge">
                <input ng-model="canvasData.isketch.myGuess" type="text" id="isketchGuess" name="isketchGuess" size="15" maxlength="16" />
                <button type="submit">Guess</button>
            </form>
        </div>
        <videos></videos>
        <div class="dj">
            <p ng-show="getDJ()"><span class="muted">Current DJ: </span>{{ getDJ() }}</p>
            <button ng-hide="getDJ() || !auth" ng-click="becomeDJ()">Become DJ</button>
        </div>
        <div class="event-log">
            <ul><li ng-repeat="entry in eventLog" class="animate-repeat">
                <div ng-style="{opacity: (300000 - entry.age)/300000}">
                    <span>{{ entry.time | date:'H:mm:ss' }}</span>
                    <strong ng-style="{color: '#'+getUserColor(entry.user)}">{{ entry.user }} </strong>
                    <span ng-bind-html="entry.text"></span>
                </div>
            </li></ul>
        </div>
        <div ng-show="users" class="listeners">
            <h3 class="muted">Listeners</h3>
            <div class="listener" ng-repeat="(name,listener) in users" ng-show="listener.connections">
                <div><i class="fa" ng-class="listenerClasses(listener)" ng-style="{color: '#'+getUserColor(name)}"></i> {{ name }}</div>
                <div class="volume" ng-class="{muted:listener.muted}"><div ng-style="{width: listener.volume+'%'}"></div></div>
            </div>
        </div>
        <div class="message" ng-show="message" ng-click="message = null">
            <p ng-class="message.type" ng-bind-html="message.text"></p>
            <p ng-show="message.kudos">You {{message.kudos > 0 ? 'gained' : 'lost'}} <strong>{{ message.kudos }}</strong> kudos!</p>
        </div>
        <p ng-show="getJackpot()" style="text-align: center;">
            <span class="muted">Current Jackpot:</span> <strong ng-style="{fontSize: (14+(getJackpot()/10000))+'px'}">{{ getJackpot() | number }}</strong>
        </p>
        <control-buttons></control-buttons>
        <title-gamble></title-gamble>
        <div class="fill-blank control-panel" ng-show="auth && controlList.fillBlank.show">
            <p ng-show="!getKudos() || getKudos() < 5">You need to earn some more kudos first.</p>
            <p ng-show="getKudos() >= 5">Fill in the blanks from video titles and win kudos!<br />
                <small>The title is a pun, because you'll fill your bank if you win a lot!</small></p>
            <button ng-hide="fillBlankTitle || getKudos() < 5" ng-click="fillBlankGetTitle()" ng-disabled="gettingFillBlankTitle">Gimme a Title! (5 kudos)</button>
            <form ng-show="fillBlankTitle" ng-submit="fillBlankSubmit()">
                <h3 ng-bind-html="fillBlankTitle.challenge"></h3>
                <div class="letter-inputs">
                    <input class="letter-input" ng-repeat="inputLetter in fillBlankInputLetters" ng-model="inputLetter.value" ng-change="fillBlankInputChange()" ng-disabled="inputLetter.disabled" size="2" maxlength="1" type="text">
                </div>
                <p>Reward: <strong>{{ fillBlankTitle.missing.length * 5 }} kudos</strong></p>
                <button ng-disabled="fillBlankIncomplete">Submit Guess</button>
            </form>
        </div>
        <bounty></bounty>
        <add-video></add-video>
        <curator></curator>
        <div class="avatar-shop control-panel" ng-show="auth && controlList.avatarShop.show">
            <p>Click an avatar or color to purchase and/or wear it</p>
            <div class="clearfix">
                <div ng-repeat="(colorID, color) in avatarColors" ng-class="{owned: hasAvatarColor(colorID), equipped: (colorID == 'normal' && !user.avatarColor) || user.avatarColor == colorID}" ng-click="buyEquipAvatarColor(colorID)">
                    <i class="fa" ng-class="listenerClasses(users[username])" ng-style="{color: '#'+color[1]}"></i><span class="price" ng-class="{'cant-buy': !getKudos() || color[2] > getKudos()}">{{ color[2] }}</span> - <span class="name">{{ color[0] }}</span>
                </div>
            </div>
            <div class="clearfix">
                <div ng-repeat="(avatarID, avatar) in avatars" ng-class="{owned: hasAvatar(avatarID), equipped: (avatarID == 'headphones' && !user.avatar) || user.avatar == avatarID}" ng-click="buyEquipAvatar(avatarID)">
                    <i class="fa" ng-class="'fa-'+avatarID"></i><span class="price" ng-class="{'cant-buy': !getKudos() || avatar[1] > getKudos()}">{{ avatar[1] }}</span> - <span class="name">{{ avatar[0] }}</span>
                </div>
            </div>
        </div>
        <div class="changelog control-panel" ng-show="auth && controlList.changelog.show">
            <p class="muted" ng-show="!commits">Loading changelog from GitHub...</p>
            <table><tr ng-repeat="commit in commits">
                <td class="muted">{{ commit.date | timeUnits }} {{ commit.date | timeUnitsLabel }} ago</td>
                <td>{{ commit.message }}</td>
            </tr></table>
        </div>
        <div class="mumble control-panel" ng-show="auth && controlList.mumble.show">
            <p class="muted" ng-show="!mumble">Loading Mumble server info...</p>
            <p class="muted" ng-show="mumble.empty">Nobody's in the Mumble server :(</p>
            <ul ng-hide="mumble.empty">
                <li ng-repeat="(channelName, users) in mumble" ng-show="users">
                    <h3>{{ channelName }}</h3>
                    <ul><li ng-repeat="user in users">{{ user.name }}</li></ul>
                </li>
            </ul>
        </div>
        <div class="meta control-panel" ng-show="auth && controlList.meta.show">
            <button ng-click="metaGetVideoCount()" ng-hide="metaVideoCount" ng-disabled="gettingMetaVideoCount">Video Count</button>
            <h3 ng-show="metaVideoCount">Total Videos: <strong>{{ metaVidCountTotal }}</strong></h3>
            <div class="graph" ng-show="metaVideoCount">
                <div class="y-axis">
                    <div class="label" ng-repeat="yLabel in metaVidCountYAxisLabels">{{yLabel}} -</div>
                </div>
                <div class="data">
                    <div class="data-point" ng-repeat="dayCount in metaVideoCount" ng-style="{width: metaVidCountBarWidth+'%',paddingRight: metaVidCountBarMargin+'%',paddingLeft: metaVidCountBarMargin+'%'}" ng-mouseenter="metaViewVidCountDay($index)" ng-mouseleave="metaViewVidCountDay(false)">
                        <div class="bar">
                            <div class="bar-whitespace" ng-style="{height:(100-dayCount.barHeight)+'px'}">
                            </div>
                        </div>
                        <div class="label" ng-show="dayCount.showLabel">{{ dayCount.add_date | date:'shortDate' }}</div>
                    </div>
                </div>
                <div class="clearfix legend">
                    <dl ng-show="metaVidCountDay">
                        <dt class="label">Day:</dt><dd>{{ metaVidCountDay.add_date | date:'shortDate' }}</dd>
                        <dt class="label">Video Count:</dt><dd class="small">{{ metaVidCountDay.vidCount }}</dd>
                        <dt class="label">Top Submitter:</dt><dd>{{ metaVidCountDay.topSubmitter }}</dd>
                    </dl>
                </div>
            </div>
        </div>
        <div class="control-panel" ng-show="auth && controlList.admin.show">
            <button ng-click="requireVersion()">Require Version</button>
            <button ng-click="clearCanvas()">Clear Canvas</button>
        </div>
        <button ng-hide="username != getDJ() || !auth" ng-click="forceVote()">Force Vote</button>
    </section>
    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.1/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.1/angular-animate.min.js"></script>
    <script src="js/vendor/angular-sanitize.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="js/vendor/angular-slider.min.js"></script>
    <script src="js/vendor/localStorageModule.js"></script>
    <script src='https://cdn.firebase.com/js/client/1.1.2/firebase.js'></script>
    <script src="app/app.js"></script> <!-- My Stuff -->
    <script src="app/jukebox.js"></script>
    <script src="app/videos/videos.js"></script>
    <script src="app/controlbuttons/controlbuttons.js"></script>
    <script src="app/addvideo/addvideo.js"></script>
    <script src="app/bounty/bounty.js"></script>
    <script src="app/curator/curator.js"></script>
    <script src="app/titlegamble/titlegamble.js"></script>
    <script src="app/fireservice.js"></script>
    <script src="app/global.js"></script>
    <script src="app/dj.js"></script>
    <script src="app/player/player.js"></script>
    <script src="app/canvas.js"></script>
    <script src="app/polyominoes.js"></script>
    <script src="app/isketch.js"></script>
    <script src="app/utility.js"></script>
    <script src="js/vendor/seedrandom.js"></script>
    <!-- Error Reporting -->
    <!--<script src="//cdn.ravenjs.com/1.1.15/jquery,native/raven.min.js"></script>-->
    <!--<script>Raven.config('https://8d6f75cd5f26489bac4330469e1789e6@app.getsentry.com/25099', {}).install();</script>-->
</body>
</html>