<!DOCTYPE html>
<html ng-app="application">
<head>
    <title>Jukebox</title>
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'/>
    <link href="js/vendor/angular-slider.css" media="screen" rel="stylesheet"/>
    <link href="css/layout.css" media="screen" rel="stylesheet"/>
    <link href="css/theme.css" media="screen" rel="stylesheet"/>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body ng-cloak ng-controller="Main">
    <header>
        <h1>Jukebox</h1>
        <p><strong>v{{ version }}</strong> - <span class="muted">{{ versionName }}</span></p>
        <form ng-submit="login()" ng-hide="auth || initializing || needUpdate">
            <fieldset>
                <input type="text" name="username" id="username" ng-model="username" size="10" placeholder="username" />
                <input type="text" name="passcode" id="passcode" ng-model="passcode" size="5" placeholder="passcode" />
            </fieldset>
            <button type="submit"><span>Log In</span></button>
        </form>
        <p ng-show="auth">{{ username }}<span><strong>{{ user.kudos || 0 | number }} </strong>kudos</span></p>
    </header>
    <p ng-show="needUpdate" class="error"><strong>Your version is out of date,</strong> or vegeta locked the app. <strong>Shift+F5</strong> to get the latest version.</p>
    <section ng-hide="initializing || needUpdate">
        <div id="player"></div>
        <div class="now-playing" ng-show="playing">
            <h3 class="muted">NOW PLAYING</h3>
            <h2 ng-bind="playing.title"></h2>
            <h3 class="muted">added by {{ playing.added_by }}</h3>
        </div>
        <div class="video-selection animate-selection" ng-show="videoSelection">
            <h2 ng-show="auth">Pick a video</h2>
            <div class="vote-timer"><span class="muted">Time Left:</span> {{ voteTimeLeft }}</div>
            <table>
                <tr ng-repeat="video in videoSelection" ng-class="'has-'+countProperties(video.votes,false)+'-votes'">
                    <td class="muted" ng-click="vote($index)">{{ $index+1 }}.</td>
                    <td ng-click="vote($index)">{{ video.duration.stamp }}</td>
                    <td class="title" ng-click="vote($index)">
                        <span ng-bind-html="video.title"></span>
                        <i ng-show="!video.title && !video.artist && !video.track">unnamed video</i>
                        <div>
                            <span class="bounty">{{ video.bounty }}</span>
                            <i class="fa fa-heart" ng-repeat="(voter, value) in video.votes" ng-class="{mine: voter == username}"></i>
                        </div>
                    </td>
                    <td class="control">
                        <a ng-href="http://www.youtube.com/watch?v={{ video.video_id }}" target="_blank"><i class="fa fa-external-link-square"></i></a>
                    </td>
                </tr>
            </table>
        </div>
        <div class="dj">
            <p ng-show="dj"><span class="muted">Current DJ: </span>{{ dj }}</p>
            <button ng-hide="dj || !auth" ng-click="becomeDJ()">Become DJ</button>
        </div>
        <div class="event-log">
            <ul><li ng-repeat="entry in eventLog" class="animate-repeat">
                <span ng-style="{opacity: (300000 - entry.age)/300000}">{{ entry.time | date:'H:mm:ss' }}</span><span ng-bind-html="entry.text" ng-style="{opacity: (300000 - entry.age)/300000}"></span>
            </li></ul>
        </div>
        <div ng-show="users" class="listeners">
            <h3 class="muted">Listeners</h3>
            <div class="listener" ng-repeat="(name,listener) in users" ng-show="listener.connections">
                <div><i class="fa" ng-class="listenerClasses(listener)"></i> {{ name }}</div>
                <div class="volume"><div ng-style="{width: listener.volume+'%'}"></div></div>
            </div>
        </div>
        <div ng-show="message" ng-click="closeMessage()">
            <p class="message" ng-class="message.type"><i class="fa fa-close"></i><span ng-bind-html="message.text"></span></p>
            <p class="message" ng-show="message.kudos">You gained <strong>{{ message.kudos }}</strong> kudos!</p>
        </div>
        <p ng-show="jackpot" style="text-align: center;">
            <span class="muted">Current Jackpot:</span> <strong ng-style="{fontSize: (14+(jackpot/10000))+'px'}">{{ jackpot | number }}</strong>
        </p>
        <div class="control-buttons" ng-show="auth">
            <button ng-repeat="control in controlList" ng-click="showControl(control.name)" ng-class="{'selected': controlEnabled(control.name)}" ng-hide="control.name == 'controlAdmin' && username != 'vegeta897'">{{ control.title }}</button>
        </div>
        <div class="title-gamble control-panel" ng-show="auth && controlTitleGamble">
            <p ng-hide="dj">You can't place any bets without a DJ.</p>
            <p ng-show="videoSelection">You can't bet on the titles yet!</p>
            <p ng-show="videoSelection && !user.kudos">You need to earn some kudos first.</p>
            <p ng-show="titleGambleSet">You can't place more than one title bet per round.</p>
            <form ng-submit="titleGamble()" ng-show="!videoSelection && user.kudos && !titleGambleSet && dj">
                <fieldset>
                    <legend>Bet on the titles in the voting pool</legend>
                    <p>Type some letters or a word, and if that string appears in one of the video titles, you win!</p>
                    <p>The longer your string, the more you win.</p>
                    <div class="field">
                        <label for="titleGambleAmount">Amount</label>
                        <input type="text" id="titleGambleAmount" name="titleGambleAmount" ng-change="titleGambleAmount = restrictNumber(titleGambleAmount,1,user.kudos)" ng-model="titleGambleAmount" size="3"><span class="muted hint">kudos</span>
                        <slider floor="1" ceiling="{{user.kudos}}" step="1" precision="0" ng-model="titleGambleAmount"></slider>
                    </div>
                    <div class="field">
                        <label for="titleGambleString">String</label>
                        <input type="text" id="titleGambleString" name="titleGambleString" ng-change="titleGambleCalcMulti()" ng-model="titleGambleString" size="5" maxlength="30"><span class="muted hint"></span>
                    </div>
                    <p>Win multiplier: <strong>{{ titleGambleMulti || 0 | number : 2 }}</strong>x</p>
                </fieldset>
                <button type="submit" ng-disabled="titleGambleAmount < 1 || !titleGambleString || titleGambleString.length < 2" >Place ya' bet!</button>
            </form>
        </div>
        <div class="fill-blank control-panel" ng-show="auth && controlFillBlank">
            <p ng-show="!user.kudos || user.kudos < 5">You need to earn some more kudos first.</p>
            <p ng-show="user.kudos >= 5">Fill in the blanks from video titles and win kudos!<br />
                <small>The title is a pun, because you'll fill your bank if you win a lot!</small></p>
            <button ng-hide="fillBlankTitle || user.kudos < 5" ng-click="fillBlankGetTitle()" ng-disabled="gettingFillBlankTitle">Gimme a Title! (5 kudos)</button>
            <div ng-show="fillBlankTitle">
                <h3 ng-bind-html="fillBlankTitle.challenge"></h3>
                <div class="letter-inputs">
                    <input ng-repeat="inputLetter in fillBlankInputLetters" ng-model="inputLetter.value" ng-change="fillBlankInputChange()" size="2" maxlength="1" type="text">
                </div>
                <p>Reward: <span>{{ fillBlankTitle.missing.length * 20 }} kudos</span></p>
                <button ng-click="fillBlankSubmit()" ng-disabled="fillBlankIncomplete">Submit Guess</button>
            </div>
        </div>
        <div class="add-bounty control-panel animate-show" ng-show="auth && controlAddBounty">
            <p ng-hide="dj">You can't place a bounty without a DJ.</p>
            <p ng-hide="videoSelection">You can place a bounty when voting begins.</p>
            <p ng-show="videoSelection && !user.kudos">You need to earn some kudos first.</p>
            <p ng-show="bountySet">You can't place more than one bounty per round.</p>
            <form ng-submit="addBounty()" ng-show="videoSelection && user.kudos && !bountySet && dj">
                <fieldset>
                    <legend>Add a bounty</legend>
                    <div class="field">
                        <label for="bountyAmount">Amount</label>
                        <input type="text" id="bountyAmount" name="bountyAmount" ng-change="bountyAmount = restrictNumber(bountyAmount,1,user.kudos)" ng-model="bountyAmount" size="3"><span class="muted hint">kudos</span>
                        <slider floor="1" ceiling="{{user.kudos}}" step="1" precision="0" ng-model="bountyAmount"></slider>
                    </div>
                    <div class="field">
                        <label for="bountySelect">Video</label>
                        <select ng-model="bountyIndex" id="bountySelect" name="bountySelect" size="6" >
                            <option ng-repeat="option in videoSelection" value="{{ $index }}">{{ $index + 1 }}. {{ option.title }}</option>
                        </select>
                    </div>
                </fieldset>
                <button type="submit" ng-disabled="bountyAmount < 1" >Add it!</button>
            </form>
        </div>
        <div class="add-video control-panel animate-show" ng-show="auth && controlAddVideo">
            <form ng-submit="addVideo()">
                <fieldset ng-hide="enableBatch">
                    <legend>Add a video</legend>
                    <div class="field">
                        <label for="url">*URL or video ID</label>
                        <input name="url" id="url" ng-model="add_url" ng-change="parseURL()" type="text" placeholder="TgoAgYR4584" size="40" ng-required="!enableBatch" ng-disabled="addingVideo" />
                        <span ng-hide="add_valid || !add_url" class="invalid">Invalid URL or ID</span>
                        <span ng-show="add_valid && add_url.length > 0" class="valid" ng-bind="parsedIds"></span>
                    </div>
                    <div class="field">
                        <label for="artist">Artist</label>
                        <input name="artist" id="artist" ng-model="add_artist" type="text" placeholder="Plaid" size="30" maxlength="120" ng-disabled="addingVideo" />
                    </div>
                    <div class="field">
                        <label for="track">Track</label>
                        <input name="track" id="track" ng-model="add_track" type="text" placeholder="Two Rooms" size="30" maxlength="120" ng-disabled="addingVideo" />
                    </div>
                </fieldset>
                <fieldset ng-show="enableBatch">
                    <legend>Add a list of videos</legend>
                    <div class="field field-large">
                        <label for="url-batch">URL or ID list</label>
                        <textarea name="url-batch" id="url-batch" ng-model="batchList" ng-change="parseURL()" ng-disabled="addingVideo" ng-required="enableBatch"></textarea><br />
                        <span ng-hide="add_valid || !batchList" class="invalid">Invalid URL or ID</span>
                        <span ng-show="add_valid && batchList.length > 0" class="valid">List validated</span>
                    </div>
                </fieldset>
                <button type="submit" ng-disabled="addingVideo || (!batchList && !add_url)">Add Video{{ enableBatch ? 's' : '' }}</button>
                <input type="checkbox" name="batch" id="batch" value="batch" ng-model="enableBatch" /><label for="batch">Add a list</label>
            </form>
        </div>
        <div class="control-panel curator" ng-show="auth && controlCurator">
            <p ng-hide="curateList && curateList.length > 0">Add or correct the artist and track names in the database!</p>
            <p ng-show="curateList && curateList.length > 0">If you don't know how a video should be tagged, click the X button.</p>
            <p ng-show="curateList && curateList.length > 0">If a video is already correct, don't click the X or it will not be marked as curated.</p>
            <button ng-click="beginCurator()" ng-hide="curateList && curateList.length > 0" ng-disabled="gettingUncurated">Pull up some videos</button>
            <ul ng-show="curateList && curateList.length > 0">
                <li ng-repeat="video in curateList">
                    <button class="close" ng-click="removeFromCurator($index)" ng-disabled="savingCurated"><i class="fa fa-close"></i></button>
                    <h3>{{ video.title }} <a ng-href="http://www.youtube.com/watch?v={{ video.video_id }}" target="_blank"><i class="fa fa-external-link-square"></i></a></h3>
                    <label>Artist</label><input ng-model="video.artist" type="text" size="24" maxlength="120" ng-change="video.artist = video.artist.trim()" ng-disabled="savingCurated" />
                    <label>Track</label><input ng-model="video.track" type="text" size="32" maxlength="120" ng-change="video.track = video.track.trim()" ng-disabled="savingCurated" />
                </li>
            </ul>
            <button ng-show="curateList && curateList.length > 0" ng-click="saveCurated()" ng-disabled="savingCurated">Save these badboys!</button>
        </div>
        <div class="avatar-shop control-panel animate-show" ng-show="auth && controlAvatarShop">
            <p>Click an avatar to purchase and/or wear it</p>
            <div class="clearfix">
                <div ng-repeat="(avatarID, avatar) in avatars" ng-class="{owned: hasAvatar(avatarID), equipped: (avatarID == 'headphones' && !user.avatar) || user.avatar == avatarID}" ng-click="buyEquipAvatar(avatarID)">
                    <i class="fa" ng-class="'fa-'+avatarID"></i><span class="price" ng-class="{'cant-buy': !user.kudos || avatar[1] > user.kudos}">{{ avatar[1] }}</span> - <span class="name">{{ avatar[0] }}</span>
                </div>
            </div>
        </div>
        <div class="changelog control-panel animate-show" ng-show="auth && controlChangelog">
            <table><tr ng-repeat="commit in commits">
                <td class="muted">{{ commit.date | timeUnits }} {{ commit.date | timeUnitsLabel }} ago</td>
                <td>{{ commit.message }}</td>
            </tr></table>
        </div>
        <div class="mumble control-panel animate-show" ng-show="auth && controlMumble">
            <p class="muted" ng-show="mumble.empty">Nobody's in the mumble server :(</p>
            <ul ng-hide="mumble.empty">
                <li ng-repeat="(channelName, users) in mumble" ng-show="users">
                    <h3>{{ channelName }}</h3>
                    <ul><li ng-repeat="user in users">{{ user.name }}</li></ul>
                </li>
            </ul>
        </div>
        <div class="control-panel" ng-show="auth && controlAdmin">
            <button ng-click="requireVersion()">Require Version</button>
        </div>
        <button ng-hide="username != dj || !auth" ng-click="forceVote()">Force Vote</button>
    </section>
    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.1/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.1/angular-animate.min.js"></script>
    <script src="js/vendor/angular-sanitize.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="js/vendor/angular-slider.min.js"></script>
    <script src="js/vendor/localStorageModule.js"></script>
    <script src='https://cdn.firebase.com/js/client/1.1.2/firebase.js'></script>
    <script src="app/app.js"></script> <!-- My Stuff -->
    <script src="app/jukebox.js"></script>
    <script src="js/vendor/seedrandom.js"></script>
    <!-- Error Reporting -->
    <script src="//cdn.ravenjs.com/1.1.15/jquery,native/raven.min.js"></script>
    <script>Raven.config('https://8d6f75cd5f26489bac4330469e1789e6@app.getsentry.com/25099', {}).install();</script>
</body>
</html>